<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Data Upload</title>
  <script src="js/importCommonFiles.js" type="text/javascript"></script>
  <style>
  #uploadFileButton:hover {
    background-color: #00b28f;
  }
  #uploadFileName {
    margin-left: 10px;
    font-family: sans-serif;
    color: #aaa;
  }
  </style>
</head>
<body onload="init()">
  <div class="heading-1 centered-text bold-text">
    Upload Dataset
  </div>
  <div class="normal-text centered-text margin-top-extra-large">
    <form method="post">
      Select the database file:<br>
      <input type="file" id="uploadedFile" hidden="hidden" />
      <button type="button" class="btn btn-info margin-top-normal" id="uploadFileButton">CHOOSE A FILE</button>
      <div id="uploadFileName" class="margin-top-normal">No file chosen, yet.</div>
      <input type="checkbox" id="headerFlag" name="headerFlag" class="margin-top-normal" checked> File includes header<br>
      <button type="button" class="btn btn-primary" onclick="uploadData()">Proceed</button><br>
      <div id="errorMsg" class="error-text margin-top-normal"></div>
    </form>
  </div>
  <script>

  function init() {
    initFileButton();
  }

  function initFileButton() {
    const realFileBtn = document.getElementById("uploadedFile");
    const customBtn = document.getElementById("uploadFileButton");
    const customTxt = document.getElementById("uploadFileName");

    customBtn.addEventListener("click", function() {
      realFileBtn.click();
    });

    realFileBtn.addEventListener("change", function() {
      if (realFileBtn.value) {
        customTxt.innerHTML = realFileBtn.value.match(
          /[\/\\]([\w\d\s\.\-\(\)]+)$/
        )[1];
      } else {
        customTxt.innerHTML = "No file chosen, yet.";
      }
    });
  }

  function uploadData() {
    if (checkUploadedFile()) {
      var xhr = new XMLHttpRequest();
      var url = "http://127.0.0.1:5000/trainUpload";
      xhr.open("POST", url, true);
      var file=document.getElementById("uploadedFile").files[0];
      var headerFlag = document.getElementById("headerFlag");
      var form_data = new FormData();
      form_data.append('file',file);
      form_data.append('headerFlag',headerFlag.checked);
      xhr.onreadystatechange = function ()
      {
        if (xhr.readyState === 4 && xhr.status === 200)
        {
          var uploadText=xhr.responseText;
          if (uploadText=="File uploaded successfully")
          {
            addToSessionStorage("datasetUploaded", true);
          }
          else
          {
            document.getElementById("errorMsg").innerHTML = uploadText;
          }
        }
      };
      xhr.send(form_data);
    } else {
      document.getElementById("errorMsg").innerHTML="No file Selected!";
    }
  }

  function checkUploadedFile() {
    if (document.getElementById("uploadedFile").files[0] == null) {
      return false;
    } else {
      return true;
    }
  }
  </script>
</body>
</html>
